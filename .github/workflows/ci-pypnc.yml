name: CI-pypnc

on:
    push:
        paths:
            - "pypnc/**"
            - "tests/**"
    pull_request:
        paths:
            - "pypnc/**"
            - "tests/**"

jobs:
    pypnc-checks:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: [3.8, 3.9, 3.10, 3.11]
        steps:
          - uses: actions/checkout@v4
          - name: Set up Python
            uses: actions/setup-python@v4
            with:
              python-version: ${{ matrix.python-version }}
          - name: Install dependencies
            run: |
                python -m pip install --upgrade pip
                if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
                if [ -f requirements-dev.txt ]; then pip install -r requirements-dev.txt; fi
          - name: Lint pypnc (flake8)
            run: |
                python -m flake8 pypnc
          - name: Typecheck pypnc (mypy)
            run: |
                python -m mypy pypnc
          - name: Run tests (pytest)
            run: |
                pytest -q
